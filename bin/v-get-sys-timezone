#!/bin/bash
# info: get system timezone
# options: [FORMAT]
#
# This function to get system timezone

#----------------------------------------------------------#
#                Variables & Functions                     #
#----------------------------------------------------------#

# Argument definition
format=${1-shell}

# Includes
# shellcheck source=/etc/skynetcp/skynet.conf
source /etc/skynetcp/skynet.conf
# shellcheck source=/usr/local/skynet/func/main.sh
source $SKYNET/func/main.sh
# load config file
source_conf "$SKYNET/conf/skynet.conf"

#----------------------------------------------------------#
#                       Action                             #
#----------------------------------------------------------#

# Checking timesonze on RHEL/CentOS
if [ -f "/etc/sysconfig/clock" ]; then
	source /etc/sysconfig/clock

# Checking timezone on Debian/Ubuntu
elif [ -f "/etc/timezone" ]; then
	ZONE=$(cat /etc/timezone)

# Checking symlynks
elif [ -h /etc/localtime ]; then
	ZONE=$(readlink /etc/localtime | sed "s%.*share/zoneinfo/%%")

# Parsing zoneinfo (very slow)
else
	checksum=$(md5sum /etc/localtime | cut -d' ' -f1)
	ZONE=$(find /usr/share/zoneinfo/ -type f -exec md5sum {} \; \
		| grep "^$checksum" | sed "s/.*\/usr\/share\/zoneinfo\///" | head -n 1)
fi

echo $ZONE

#----------------------------------------------------------#
#                       Skynet                             #
#----------------------------------------------------------#

exit
